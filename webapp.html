<!DOCTYPE html>
<html>
<head>
  <title>Redirecting...</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <p>Sedang memproses absensi...</p>
  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    const user = tg.initDataUnsafe.user || {};

    fetch("https://script.google.com/macros/s/AKfycbyTngIjAKyIKM3JvMmUF0iHXnspbyiTslbd3qnU_QQ13muocEl_431Wp-cdGd-qvZgO/exec")
      .then(res => res.text())
      .then(token => {
        const nama = encodeURIComponent(user.first_name || "Unknown");
        const id = encodeURIComponent(user.id || "Unknown");

        const redirectUrl = `https://script.google.com/macros/s/AKfycbyTngIjAKyIKM3JvMmUF0iHXnspbyiTslbd3qnU_QQ13muocEl_431Wp-cdGd-qvZgO/exec?nama=${nama}&id=${id}&token=${token}`;
        window.location.href = redirectUrl;
      })
      .catch(() => {
        document.body.innerHTML = "<p>Gagal memuat token. Coba lagi.</p>";
      });
  </script>
</body>
</html>
